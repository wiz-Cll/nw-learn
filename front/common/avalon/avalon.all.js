!function(DOC){function noop(){}function log(e){window.console&&console.log(W3C?e:e+"")}function getType(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?class2type[serialize.call(e)]||"object":typeof e}function isWindow(e){return rwindow.test(serialize.call(e))}function resetNumber(e,t,r){return e=e!==+e||e%1?r?t:0:0>e?-1*e>=t?0:e+t:e>t?t:e}function oneObject(e,t){"string"==typeof e&&(e=e.match(rword)||[]);for(var r={},n=void 0!==t?t:1,a=0,o=e.length;o>a;a++)r[e[a]]=n;return r}function isArrayLike(e){if(e&&"object"==typeof e){var t=e.length;if(+t===t&&!(t%1)&&t>=0)try{return{}.propertyIsEnumerable.call(e,"length")===!1?Array.isArray(e)||/^\s?function/.test(e.item||e.callee):!0}catch(r){return!0}}return!1}function generateID(){return"avalon"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function iterator(e,t,r){var n="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+r;return Function("fn,scope",n)}function kernel(e){for(var t in e)if(ohasOwn.call(e,t)){var r=e[t];"function"==typeof kernel.plugins[t]?kernel.plugins[t](r):kernel[t]=r}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function parseData(val){var _eval=!1;(rparse.test(val)||+val+""===val)&&(_eval=!0);try{return _eval?eval("0,"+val):val}catch(e){return val}}function getWindow(e){return e.window&&e.document?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}function getValType(e){var t=e.tagName.toLowerCase();return"input"===t&&/checkbox|radio/.test(e.type)?"checked":t}function updateViewModel(e,t,r){if("array"===r){var n=t.concat();return e.clear(),e.push.apply(e,n),e}var a=[],o=[],i=[],s=[],l=[],c=e[subscribers],u=e.$model;for(var f in u)t&&t.hasOwnProperty(f)||(o.push(f),delete u[f]);for(var f in t)t.hasOwnProperty(f)&&"hasOwnProperty"!==f&&(e.hasOwnProperty(f)||a.push(f),l.push(f));for(var f in u)u.hasOwnProperty(f)&&(s.push(f),u[f]!==t[f]&&i.push(f));c.forEach(function(e){e("remove",o)}),c.forEach(function(e){e("add",t)}),i.length&&i.forEach(function(r){var n=getType(t[r]);rchecktype.test(n)?updateViewModel(e[r],t[r],n):e[r]=t[r]}),s.join(";")!==l.join(";")&&c.forEach(function(e){e("sort",l,s)});var p=e.$events;if(a.length||o.length){for(var d,h=e.$model,f=0;d=o[f++];)delete h[d],delete p[d],delete e.$accessor[d];for(f=0,d;d=a[f++];)h[d]=t[d];e=modelFactory(h,h,{},e.$accessor)}return e[subscribers]=c,c.forEach(function(t){t.host=e}),e.$events=p,e}function modelFactory(e,t,r,n){function a(e,n){unwatchOne[e]||(t[e]=n);var a=getType(n);if("function"===a)f.push(e);else{if(-1!==i.indexOf(e)||"$"===e.charAt(0)&&!r[e])return f.push(e);var o,p;if("object"===a&&"function"==typeof n.get&&Object.keys(n).length<=2){var d=n.set,h=n.get;o=function(r){var n=o.value,a=n;if(!arguments.length)return openComputedCollect&&collectSubscribers(o),r=o.value=t[e]=h.call(s),isEqual(n,r)||(p=void 0,s.$fire&&s.$fire(e,r,n)),r;if(!stopRepeatAssign){if("function"==typeof d){var i=s.$events[e];s.$events[e]=[],d.call(s,r),s.$events[e]=i}isEqual(p,r)||(p=r,n=o.value=t[e]=h.call(s),notifySubscribers(o),s.$fire&&s.$fire(e,n,a))}},u.push(o)}else o=function(r){var n,i=o.value,l=i;return arguments.length?(stopRepeatAssign||isEqual(i,r)||(rchecktype.test(a)?("value"in o?(i=updateViewModel(i,r,a),s.$fire&&s.$fire(e,i,l)):i=r.$model?r:modelFactory(r,r),o[subscribers]=i[subscribers],n=i.$model):i=r,o.value=i,t[e]=n?n:i,notifySubscribers(o),n||s.$fire&&s.$fire(e,i,l)),void 0):(collectSubscribers(o),i)},c.push(e);o[subscribers]=[],l[e]={set:o,get:o,enumerable:!0}}}if(Array.isArray(e)){var o=Collection(e);return o._add(e),o}var i=e.$skipArray,s={},l={},c=[],u=[],f=Object.keys(unwatchOne);t=t||{},r=r||{},i=Array.isArray(i)?i.concat(f):f;for(var p in e)a(p,e[p]);if(n)for(var p in n)l[p]=n[p];s=defineProperties(s,l,f),f.forEach(function(t){unwatchOne[t]||(s[t]=e[t])}),c.forEach(function(t){s[t]=e[t]}),u.forEach(function(e){Registry[expose]=e,e(),collectSubscribers(e),delete Registry[expose]}),s.$model=t,s.$events={},s.$id=generateID(),s.$accessor=l,s[subscribers]=[];for(var p in Observable){var d=Observable[p];W3C||(d=d.bind(s)),s[p]=d}return s.hasOwnProperty=function(e){return e in s.$model},s}function VBMediator(e,t,r){var n=e[t]&&e[t].set;return 3!==arguments.length?n():(n(r),void 0)}function registerSubscriber(e,t){e.element=t.element,e.state=t.state,Registry[expose]=e,openComputedCollect=!0,e(),openComputedCollect=!1,delete Registry[expose]}function collectSubscribers(e){if(Registry[expose]){var t=e[subscribers];t&&avalon.Array.ensure(t,Registry[expose])}}function notifySubscribers(e){var t=e[subscribers];if(t&&t.length)for(var r,n=aslice.call(arguments,1),a=t.concat(),o=0;r=a[o++];){var i,s=r.element,l=r.state;if(s&&(!l||0!==l.sourceIndex))if("number"==typeof s.sourceIndex)i=0===s.sourceIndex;else try{i=!root.contains(s)}catch(c){for(i=!0;s==s.parentNode;)if(s===root){i=!1;break}}i?avalon.Array.remove(t,r):r.apply(0,n)}}function scanNodes(e,t,r){for(var n,a=[],o=0;n=e.childNodes[o++];)a.push(n);for(var o=0;n=a[o++];)1===n.nodeType?scanTag(n,t,r):3===n.nodeType&&scanText(n,t,r)}function scanTag(e,t,r,n){t=t||[];var a=e.getAttribute(prefix+"skip"),o=e.getAttributeNode(prefix+"important"),i=e.getAttributeNode(prefix+"controller");if("string"!=typeof a){if(n=o||i){var s=VMODELS[n.value];if(!s)return;t=n===o?[s]:[s].concat(t),e.removeAttribute(n.name)}scanAttr(e,t,function(r){!stopScan[e.tagName.toLowerCase()]&&rbind.test(e.innerHTML)&&scanNodes(e,t,r)},r)}}function scanText(e,t,r){var n=extractTextBindings(e);n.length&&executeBindings(n,t,r)}function scanExpr(e){var t,r,n=[],a=0;if(rexpr.test(e)){for(;;){if(r=e.indexOf(openTag,a),-1===r)break;if(t=e.slice(a,r),t&&n.push({value:t,expr:!1}),a=r+openTag.length,r=e.indexOf(closeTag,a),-1===r)break;if(t=e.slice(a,r)){var o=[];t.indexOf("|")>0&&(t=t.replace(rfilters,function(e,t,r){return o.push(t+(r||"")),""})),n.push({value:t,expr:!0,filters:o.length?o:void 0})}a=r+closeTag.length}t=e.slice(a),t&&n.push({value:t,expr:!1})}return n}function scanAttr(e,t,r,n,a){for(var o,i=[],s=0;o=e.attributes[s++];)if(o.specified&&-1!==o.name.indexOf(prefix)){var l=o.name.split("-"),c=l[1];"function"==typeof bindingHandlers[c]&&function(t){var r={type:c,param:l.slice(2).join("-"),element:e,remove:!0,node:t,value:t.nodeValue};"ms-if"===t.name?a=r:i.push(r)}(o)}i.sort(function(e,t){return e.node.name>t.node.name}),a?(a.state={},bindingHandlers["if"](a,t,function(){executeBindings(i,t,a.state),r(a.state)})):(executeBindings(i,t,n),r(n))}function executeBindings(e,t,r){e.forEach(function(e){e.state=r,bindingHandlers[e.type](e,t),e.remove&&e.element.removeAttribute(e.node.name),e.remove=!0}),e.length=0}function extractTextBindings(e){var t=[],r=scanExpr(e.nodeValue);if(r.length){for(;r.length;){var n=r.shift(),a=DOC.createTextNode(n.value);if(n.expr){var o=n.filters,i={type:"text",node:a,param:"",element:e.parentNode,value:n.value,filters:o};o&&-1!==o.indexOf("html")&&(avalon.Array.remove(o,"html"),i.type="html",i.replaceNodes=[a]),t.push(i)}documentFragment.appendChild(a)}e.parentNode.replaceChild(documentFragment,e)}return t}function addAssign(e,t,r){for(var n=[],a=" = "+r+".",o=e.length;r=e[--o];)r=e[o],t.hasOwnProperty(r)&&(n.push(r+a+r),e.splice(o,1));return n}function uniqArray(e,t){var r=e.length;if(1>=r)return e;if(2===r)return e[0]!==e[1]?e:[e[0]];var n={};return e.filter(function(e){var r=t?e&&e.$id:e;return n[r]?!1:(n[r]=1,!0)})}function parseExpr(e,t,r,n){if("setget"===n){var a=Function("a","b","if(arguments.length === 2){\n	a."+e+" = b;\n }else{\n	return a."+e+";\n}");l=t}else{var o=getVariables(e),i=[],s=[],l=[],c="";o=uniqArray(o),t=uniqArray(t,1);for(var u=0,f=t.length;f>u;u++)if(o.length){var p="vm"+expose+"_"+u;s.push(p),l.push(t[u]),i.push.apply(i,addAssign(o,t[u],p))}var c=i.join(", ");if(c&&(c="var "+c),"on"===r.type&&(e=e.replace("(",".call(this,"),"$event"===n&&s.push(n)),r.filters){e="\nvar ret"+expose+" = "+e;var d,h=[];h.push(e,"\r\n");for(var v,u=0;v=r.filters[u++];){var m=v.indexOf("(");-1!==m?(d=v.slice(m+1,v.lastIndexOf(")")).trim(),d=","+d,v=v.slice(0,m).trim()):d="",h.push(" if(filters",expose,".",v,"){\n	try{\nret",expose," = filters",expose,".",v,"(ret",expose,d,")\n	}catch(e){} \n}\n")}e=h.join(""),e+="\nreturn ret"+expose,s.push("filters"+expose),l.push(avalon.filters),delete r.filters}else e="\nreturn "+e+";";try{a=Function.apply(Function,s.concat("'use strict';\n"+c+e))}catch(g){}}try{return"on"!==r.type&&"setget"!==n&&a.apply(a,l),[a,l]}catch(g){delete r.remove}finally{h=s=null}}function updateViewFactory(e,t,r,n,a){var o,i;if(a)o=a.map(function(e){return e.expr?parseExpr(e.value,t,r)||"":e.value}),i=function(e,t){return function(){for(var n,a,o="",i=0;a=e[i++];)"string"==typeof a?o+=a:(n=a[0],o+=n.apply(n,a[1]));return t(o,r.element)}}(o,n);else if(o=parseExpr(e,t,r)){var s=o[0],l=o[1];i=function(){n(s.apply(s,l),r.element)}}i&&(i.toString=function(){return r.type+" binding to eval("+e+")"},registerSubscriber(i,r))}function parseDisplay(e,t){if(e=e.toLowerCase(),!cacheDisplay[e]){var r=DOC.createElement(e);root.appendChild(r),t=window.getComputedStyle?window.getComputedStyle(r,null).display:r.currentStyle.display,root.removeChild(r),cacheDisplay[e]=t}return cacheDisplay[e]}function fixEvent(e){var t=e.target=e.srcElement;if(e.which=null!=e.charCode?e.charCode:e.keyCode,/mouse|click/.test(e.type)){var r=t.ownerDocument||DOC,n="BackCompat"===r.compatMode?r.body:r.documentElement;e.pageX=e.clientX+(n.scrollLeft>>0)-(n.clientLeft>>0),e.pageY=e.clientY+(n.scrollTop>>0)-(n.clientTop>>0)}return e.preventDefault=function(){e.returnValue=!1},e.stopPropagation=function(){e.cancelBubble=!0},e}function convert(e){var t=getType(e);return rchecktype.test(t)&&(e=e.$id?e:modelFactory(e,e,t)),e}function getVMIndex(e,t,r){for(var n=r,a=t.length;a>n;n++){var o=t[n],i=o&&o.$model?o.$model:o;if(isEqual(e,i))return n}return-1}function Collection(e){var t=[];t.$id=generateID(),t[subscribers]=[],t.$model=e.concat(),t.$events={},t._=modelFactory({length:e.length}),t._.$watch("length",function(e,r){t.$fire("length",e,r)});for(var r in Observable)t[r]=Observable[r];return avalon.mix(t,CollectionPrototype),t}function eachIterator(e,t,r,n,a){var o=n.group,i=n.element,s=n.mapper;if("del"==e||"move"==e)var l=getLocatedNode(i,o,t);switch(e){case"add":for(var c=t,t=r,u=documentFragment.cloneNode(!1),f=0,p=c.length;p>f;f++){var d=f+t,h=createEachProxy(d,c[f],a,n.param),v=n.template.cloneNode(!0);s.splice(d,0,h);var m="object"==typeof c[f]?[h,c[f]]:[h];scanNodes(v,m.concat(n.vmodels),n.state),h.$accessor.$last.get.element=v.firstChild,"number"!=typeof o&&(n.group=v.childNodes.length),u.appendChild(v)}l=getLocatedNode(i,o,t),i.insertBefore(u,l);break;case"del":s.splice(t,r),removeView(l,o,r);break;case"index":for(;r=s[t];t++)r.$index=t;break;case"clear":s.length=0,avalon.clearChild(i);break;case"move":var g=s.splice(t,1)[0];if(g){s.splice(r,0,g);var y=removeView(l,o);l=getLocatedNode(i,o,r),i.insertBefore(y,l)}break;case"set":var b=s[t];if(b){var p=b.$itemName;b[p]=r}}}function withIterator(e,t,r,n,a,o){var i=n.group,s=n.element,l=n.markstone,c=[];switch(o=o||documentFragment.cloneNode(!1),e){case"append":var u=t,f=withMapper[a.$id]||(withMapper[a.$id]={});if(!f[u]){var p=createWithProxy(u,r);f[u]=p,r&&r.$model&&(p.$events=a.$events,p[subscribers]=a[subscribers]),a.$watch(u,function(e){p.$val=e})}var d=n.template.cloneNode(!0);scanNodes(d,[f[u],r].concat(n.vmodels),n.state),"number"!=typeof i&&(n.group=d.childNodes.length),l[u]=d.firstChild,o.appendChild(d);break;case"sort":for(var h,v=0;h=t[v++];){var m=l[h],g=removeView(m,i);o.appendChild(g)}s.appendChild(o);break;case"add":for(var v in t)t.hasOwnProperty(v)&&"hasOwnProperty"!==v&&(l.hasOwnProperty(v)||(withIterator("append",v,t[v],n,a,o),c.push(v)));return s.appendChild(o),c;case"remove":for(var h,y=[],v=0;h=t[v++];){var m=l[h];m&&(l[h]=withMapper[a.$id][h]=0,y.push(m),gatherRemovedNodes(y,m,i))}for(v=0;m=y[v++];)s.removeChild(m);return c}}function gatherRemovedNodes(e,t,r){for(var n=1;r>n;n++)t=t.nextSibling,e.push(t);return e}function getLocatedNode(e,t,r){return e.childNodes[t*r]||null}function removeView(e,t,r){r=r||1;for(var e,n=gatherRemovedNodes([e],e,t*r),a=documentFragment.cloneNode(!1),o=0;e=n[o++];)a.appendChild(e);return a}function createWithProxy(e,t){return modelFactory({$key:e,$val:t},0,{$val:1})}function createEachProxy(e,t,r,n){n=n||"el";var a={};a.$index=e,a.$itemName=n,a[n]={get:function(){return t},set:function(e){t=e}},a.$first={get:function(){return 0===this.$index}},a.$last={get:function(){var e="function"==typeof r.size?r.size():r.length;return this.$index===e-1}},a.$remove=function(){return r.removeAt(o.$index)};var o=modelFactory(a,0,watchEachOne);return o}function fireReady(){document.body&&(modules["ready!"].state=2,innerRequire.checkDeps(),fireReady=noop)}function doScrollCheck(){try{root.doScroll("left"),fireReady()}catch(e){setTimeout(doScrollCheck)}}var Registry={},expose=new Date-0,subscribers="$"+expose,otherRequire=window.require,otherDefine=window.define,stopRepeatAssign=!1,openComputedCollect=!1,rword=/[^, ]+/g,class2type={},oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,prefix="ms-",W3C=window.dispatchEvent,root=DOC.documentElement,serialize=oproto.toString,aslice=[].slice,head=DOC.head||DOC.getElementsByTagName("head")[0],documentFragment=DOC.createDocumentFragment(),DONT_ENUM="propertyIsEnumerable,isPrototypeOf,hasOwnProperty,toLocaleString,toString,valueOf,constructor".split(",");"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()});var rnative=/\[native code\]/,rchecktype=/^(?:object|array)$/,rwindow=/^[object (Window|DOMWindow|global)]$/;avalon=function(e){return new avalon.init(e)},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=getType,avalon.isWindow=function(e){return e?e==e.document&&e.document!=e:!1},isWindow(window)&&(avalon.isWindow=isWindow),avalon.isPlainObject=function(e){if("object"!==getType(e)||e.nodeType||this.isWindow(e))return!1;try{if(e.constructor&&!ohasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(e){return e&&"object"==typeof e&&Object.getPrototypeOf(e)===oproto}),avalon.mix=avalon.fn.mix=function(){var e,t,r,n,a,o,i=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},s++),"object"!=typeof i&&"function"!==getType(i)&&(i={}),s===l&&(i=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)r=i[t],n=e[t],i!==n&&(c&&n&&(avalon.isPlainObject(n)||(a=Array.isArray(n)))?(a?(a=!1,o=r&&Array.isArray(r)?r:[]):o=r&&avalon.isPlainObject(r)?r:{},i[t]=avalon.mix(c,o,n)):void 0!==n&&(i[t]=n));return i};var eventMap=avalon.eventMap={};avalon.mix({rword:rword,subscribers:subscribers,ui:{},log:log,slice:W3C?function(e,t,r){return aslice.call(e,t,r)}:function(e,t,r){var n=[],a=e.length;t=resetNumber(t,a),r=resetNumber(r,a,1);for(var o=t;r>o;++o)n[o-t]=e[o];return n},noop:noop,error:function(e,t){throw new(t||Error)(e)},oneObject:oneObject,range:function(e,t,r){r||(r=1),null==t&&(t=e||0,e=0);for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r)),o=Array(a);++n<a;)o[n]=e,e+=r;return o},bind:function(e,t,r,n){function a(t){var n=t.target?t:fixEvent(t||window.event),a=r.call(e,n);return a===!1&&(n.preventDefault(),n.stopPropagation()),a}if(W3C)e.addEventListener(eventMap[t]||t,a,!!n);else try{e.attachEvent("on"+t,a)}catch(o){}return a},unbind:W3C?function(e,t,r,n){e.removeEventListener(eventMap[t]||t,r||noop,!!n)}:function(e,t,r){e.detachEvent("on"+t,r||noop)},css:function(e,t,r){if(e instanceof avalon){var n=e;e=e[0]}var a=/[_-]/.test(t)?camelize(t):t;if(t=avalon.cssName(a)||a,void 0===r||"boolean"==typeof r){var o=cssHooks[a+":get"]||cssHooks["@:get"],i=o(e,t);return r===!0?parseFloat(i)||0:i}if(""===r)e.style[t]="";else{if(null==r||r!==r)return;isFinite(r)&&!avalon.cssNumber[a]&&(r+="px"),o=cssHooks[a+":set"]||cssHooks["@:set"],o(e,t,r)}return n}});var BrowserMutationObserver=window.MutationObserver||window.WebKitMutationObserver;avalon.nextTick=BrowserMutationObserver?function(e){var t=DOC.createElement("input"),r=new BrowserMutationObserver(function(t){t.forEach(function(){e()})});r.observe(t,{attributes:!0}),t.setAttribute("value",Math.random())}:window.VBArray?function(e){var t=DOC.createElement("script");t.onreadystatechange=function(){e(),t.onreadystatechange=null,root.removeChild(t),t=null},root.appendChild(t)}:function(e){setTimeout(e,0)};var VMODELS=avalon.vmodels={};avalon.each=function(e,t){if(e){var r=0;if(isArrayLike(e))for(var n=e.length;n>r;r++)t(r,e[r]);else for(r in e)e.hasOwnProperty(r)&&t(r,e[r])}},"司徒正美".trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});for(var i in{toString:1})DONT_ENUM=!1;Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);if(DONT_ENUM&&e)for(var n=0;r=DONT_ENUM[n++];)e.hasOwnProperty(r)&&t.push(r);return t}),Array.isArray||(Array.isArray=function(e){return e&&"array"===getType(e)}),noop.bind||(Function.prototype.bind=function(e){if(arguments.length<2&&void 0===e)return this;var t=this,r=arguments;return function(){var n,a=[];for(n=1;n<r.length;n++)a.push(r[n]);for(n=0;n<arguments.length;n++)a.push(arguments[n]);return t.apply(e,a)}}),rnative.test([].map)||avalon.mix(Array.prototype,{indexOf:function(e,t){var r=this.length,n=~~t;for(0>n&&(n+=r);r>n;n++)if(this[n]===e)return n;return-1},lastIndexOf:function(e,t){var r=this.length,n=null==t?r-1:t;for(0>n&&(n=Math.max(0,r+n));n>=0;n--)if(this[n]===e)return n;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),root.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))});var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={alias:function(e){var t=kernel.alias;for(var r in e)if(ohasOwn.call(e,r)){var n=t[r],a=e[r];n&&avalon.error("注意 "+r+" 已经重写过"),t[r]=a}},loader:function(e){e?(window.define=innerRequire.define,window.require=innerRequire):(window.define=otherDefine,window.require=otherRequire)},interpolate:function(e){if(Array.isArray(e)&&e[0]&&e[1]&&e[0]!==e[1]){openTag=e[0],closeTag=e[1];var t=escapeRegExp(openTag),r=escapeRegExp(closeTag);rexpr=new RegExp(t+"(.*?)"+r),rexprg=new RegExp(t+"(.*?)"+r,"g"),rbind=new RegExp(t+".*?"+r+"|\\sms-")}}};kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.alias={},avalon.config=kernel;var rparse=/^(?:null|false|true|NaN|\{.*\}|\[.*\])$/,rnospaces=/\S+/g;avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return 1===t.nodeType?!!t.className&&(" "+t.className+" ").indexOf(" "+e+" ")>-1:void 0},addClass:function(e){var t=this[0];if(e&&"string"==typeof e&&t&&1===t.nodeType)if(t.className){var r=(t.className+" "+e).match(rnospaces);r.sort();for(var n=r.length-1;n>0;--n)r[n]===r[n-1]&&r.splice(n,1);t.className=r.join(" ")}else t.className=e;return this},removeClass:function(e){var t=this[0];if(e&&typeof e>"o"&&t&&1===t.nodeType&&t.className){for(var r=(e||"").match(rnospaces)||[],n=r.length,a=" "+t.className.match(rnospaces).join(" ")+" ",o=0;n>o;o++)a=a.replace(" "+r[o]+" "," ");t.className=a.slice(1,a.length-1)}return this},toggleClass:function(e,t){for(var r,n=t,a=0,o=e.match(rnospaces)||[],i="boolean"==typeof t;r=o[a++];)n=i?n:!this.hasClass(r),this[n?"addClass":"removeClass"](r);return this},attr:function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){switch(e="data-"+hyphen(e||""),arguments.length){case 2:return this.attr(e,t),this;case 1:var r=this.attr(e);return parseData(r);case 0:for(var n,a=this[0].attributes,o={},i=0;n=a[i++];)e=n.name,e.indexOf("data-")||(e=camelize(e.slice(5)),o[e]=parseData(n.value));return o}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){return avalon.css(this,e,t)},position:function(){var e,t,r=this[0],n={top:0,left:0};if(r)return"fixed"===this.css("position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),"HTML"!==e[0].tagName&&(n=e.offset()),n.top+=avalon.css(e[0],"borderTopWidth",!0),n.left+=avalon.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-avalon.css(r,"marginTop",!0),left:t.left-n.left-avalon.css(r,"marginLeft",!0)}},offsetParent:function(){for(var e=this[0].offsetParent||root;e&&"HTML"!==e.tagName&&"static"===avalon.css(e,"position");)e=e.offsetParent;return avalon(e||root)},bind:function(e,t,r){return this[0]?avalon.bind(this[0],e,t,r):void 0},unbind:function(e,t,r){return this[0]&&avalon.unbind(this[0],e,t,r),this},val:function(e){var t=this[0];if(t&&1===t.nodeType){var r=0===arguments.length,n=r?":get":":set",a=valHooks[getValType(t)+n];if(a)var o=a(t,e);else{if(r)return(t.value||"").replace(/\r/g,"");t.value=e}}return r?o:this}}),avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(r){var n=this[0]||{},a=getWindow(n),o="scrollTop"===e;return arguments.length?(a?a.scrollTo(o?avalon(a).scrollLeft():r,o?r:avalon(a).scrollTop()):n[e]=r,void 0):a?t in a?a[t]:root[e]:n[e]}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":"cssFloat"in root.style?"cssFloat":"styleFloat",background:"backgroundColor"};if(avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,r){if(cssMap[e])return cssMap[e];t=t||root.style;for(var n=0,a=prefixes.length;a>n;n++)if(r=camelize(prefixes[n]+e),r in t)return cssMap[e]=r;return null},cssHooks["@:set"]=function(e,t,r){try{e.style[t]="",e.style[t]=r}catch(n){}},window.getComputedStyle)cssHooks["@:get"]=function(e,t){var r,n=window.getComputedStyle(e,null);return n&&(r="filter"===t?n.getPropertyValue(t):n[t],""===r&&(r=e.style[t])),r},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return""===t?"1":t};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(e,t){var r=e.currentStyle,n=r[t];if(rnumnonpx.test(n)&&!rposition.test(n)){var a=e.style,o=a.left,i=e.runtimeStyle.left;e.runtimeStyle.left=r.left,a.left="fontSize"===t?"1em":n||0,n=a.pixelLeft+"px",a.left=o,e.runtimeStyle.left=i}return"medium"===n&&(t=t.replace("Width","Style"),"none"===r[t]&&(n="0px")),""===n?"auto":border[n]||n},cssHooks["opacity:set"]=function(e,t,r){e.style.filter="alpha(opacity="+100*r+")",e.style.zoom=1},cssHooks["opacity:get"]=function(e){var t=e.filters.alpha||e.filters[salpha],r=t?t.opacity:100;return r/100+""}}"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var r=cssHooks["@:get"](t,e);return/px$/.test(r)?r:avalon(t).position()[e]+"px"}}),"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),r="client"+e,n="scroll"+e,a="offset"+e;avalon.fn[t]=function(o){var i=this[0];if(0===arguments.length){if(i.setTimeout)return i["inner"+e]||i.document.documentElement[r];if(9===i.nodeType){var s=i.documentElement;return Math.max(i.body[n],s[n],i.body[a],s[a],s[r])}return parseFloat(this.css(t))||0}return this.css(t,o)}}),avalon.fn.offset=function(){var e=this[0],t=e&&e.ownerDocument,r={left:0,top:0};if(!t)return r;var n=e.getBoundingClientRect(),a=t.defaultView||t.parentWindow,o=navigator.vendor||"BackCompat"===t.compatMode?t.body:t.documentElement,i=o.clientTop>>0,s=o.clientLeft>>0,l=a.pageYOffset||o.scrollTop,c=a.pageXOffset||o.scrollLeft;return r.top=n.top+l-i,r.left=n.left+c-s,r};var valHooks={"option:get":function(e){if(e.hasAttribute)return e.hasAttribute("value")?e.value:e.text;var t=e.attributes.value;return void 0===t?e.text:t.specified?e.value:e.text},"select:get":function(e,t){for(var r,n=e.options,a=e.selectedIndex,o=valHooks["option:get"],i="select-one"===e.type||0>a,s=i?null:[],l=i?a+1:n.length,c=0>a?l:i?a:0;l>c;c++)if(r=n[c],(r.selected||c===a)&&!r.disabled){if(t=o(r),i)return t;s.push(t)}return s},"select:set":function(e,t){t=[].concat(t);for(var r,n=valHooks["option:get"],a=0;r=e.options[a++];)r.selected=!!~t.indexOf(n(r));t.length||(e.selectedIndex=-1)}};avalon.Array={ensure:function(e){var t=aslice.call(arguments,1);return t.forEach(function(t){~e.indexOf(t)||e.push(t)}),e},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var r=e.indexOf(t);return~r?avalon.Array.removeAt(e,r):!1}};var rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/gi,scriptTypes=oneObject("text/javascript","text/ecmascript","application/ecmascript","application/javascript","text/vbscript"),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,tagHooks={area:[1,"<map>"],param:[1,"<object>"],col:[2,"<table><tbody></tbody><colgroup>","</table>"],legend:[1,"<fieldset>"],option:[1,"<select multiple='multiple'>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>"],td:[3,"<table><tbody><tr>"],_default:W3C?[0,""]:[1,"X<div>"]};tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,tagHooks.th=tagHooks.td,avalon.clearChild=function(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e},avalon.parseHTML=function(e){e=e.replace(rxhtml,"<$1></$2>").trim();var t,r=(rtagName.exec(e)||["",""])[1].toLowerCase(),n=tagHooks[r]||tagHooks._default,a=documentFragment.cloneNode(!1),o=domParser;W3C||(e=e.replace(rcreate,"<br class=fix_noscope>$1")),o.innerHTML=n[1]+e+(n[2]||"");var i=o.getElementsByTagName("script");if(i.length)for(var s,l,c=DOC.createElement("script"),u=0;l=i[u++];)if(!l.type||scriptTypes[l.type]){s=c.cloneNode(!1);for(var f,p=0;f=l.attributes[p++];)f.specified&&(s[f.name]=f.value);s.text=l.text,l.parentNode.replaceChild(s,l)}for(u=n[0];u--;o=o.lastChild);if(!W3C)for(i=o.getElementsByTagName("br"),u=0;l=i[u++];)l.className&&"fix_noscope"===l.className&&l.parentNode.removeChild(l);for(;t=o.firstChild;)a.appendChild(t);return a},avalon.innerHTML=function(e,t){if(!W3C&&!rcreate.test(t)&&!rnest.test(t))try{return e.innerHTML=t,void 0}catch(r){}var n=this.parseHTML(t);this.clearChild(e).appendChild(n)},avalon.define=function(e,t){var r=aslice.call(arguments);"string"!=typeof e&&(e=generateID(),r.unshift(e)),"function"!=typeof r[1]&&avalon.error("factory必须是函数"),t=r[1];var n={$watch:noop};t(n);var a=modelFactory(n);return stopRepeatAssign=!0,t(a),stopRepeatAssign=!1,a.$id=e,VMODELS[e]=a};var Observable={$watch:function(e,t){if("function"==typeof t){var r=this.$events[e];r?r.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var r=arguments.length;if(0===r)this.$watch.backup=this.$events,this.$events={};else if(1===r)this.$events[e]=[];else for(var n=this.$events[e]||[],a=n.length;~--a<0;)if(n[a]===t)return n.splice(a,1);return this},$fire:function(e){for(var t,r=this.$events[e]||[],n=this.$events.$all||[],a=aslice.call(arguments,1),o=0;t=r[o++];)t.apply(this,a);for(var t,o=0;t=n[o++];)t.apply(this,a)}},isEqual=function(e,t){return e===t?e instanceof Date?e-0===t-0:!0:e!==e&&t!==t},unwatchOne=oneObject("$id,$skipArray,$watch,$unwatch,$fire,$events,$model,$accessor,"+subscribers),defineProperty=Object.defineProperty;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){"__defineGetter__"in avalon&&(defineProperty=function(e,t,r){return"value"in r&&(e[t]=r.value),"get"in r&&e.__defineGetter__(t,r.get),"set"in r&&e.__defineSetter__(t,r.set),e},defineProperties=function(e,t){for(var r in t)t.hasOwnProperty(r)&&defineProperty(e,r,t[r]);return e})}!defineProperties&&window.VBArray&&(window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),defineProperties=function(e,t,r){e=r.slice(0),e.push("hasOwnProperty");var n="VBClass"+setTimeout("1"),a={},o=[];o.push("Class "+n,"	Private [__data__], [__proxy__]","	Public Default Function [__const__](d, p)","		Set [__data__] = d: set [__proxy__] = p","		Set [__const__] = Me","	End Function"),e.forEach(function(e){a[e]!==!0&&(a[e]=!0,o.push("	Public ["+e+"]"))});for(var i in t)a[i]=!0,o.push("	Public Property Let ["+i+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+i+'", val'+expose+")","	End Property","	Public Property Set ["+i+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+i+'", val'+expose+")","	End Property","	Public Property Get ["+i+"]","	On Error Resume Next","		Set["+i+'] = [__proxy__]([__data__],"'+i+'")',"	If Err.Number <> 0 Then","		["+i+'] = [__proxy__]([__data__],"'+i+'")',"	End If","	On Error Goto 0","	End Property");return o.push("End Class"),o.push("Function "+n+"Factory(a, b)","	Dim o","	Set o = (New "+n+")(a, b)","	Set "+n+"Factory = o","End Function"),window.parseVB(o.join("\r\n")),window[n+"Factory"](t,VBMediator)}),avalon.scan=function(e,t,r){e=e||root;var n=t?[].concat(t):[];scanTag(e,n,r)};var stopScan=oneObject("area,base,basefont,br,col,hr,img,input,link,meta,param,embed,wbr,script,style,textarea"),rfilters=/\|\s*(\w+)\s*(\([^)]*\))?/g,keywords="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",rrexpstr=/\/\*(?:.|\n)*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|'[^']*'|"[^"]*"|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,getVariables=function(e){return e=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,""),e?e.split(/,+/):[]};avalon.parseExpr=parseExpr,avalon.updateViewFactory=updateViewFactory;var cacheDisplay=oneObject("a,abbr,b,span,strong,em,font,i,kbd","inline");avalon.mix(cacheDisplay,oneObject("div,h1,h2,h3,h4,h5,h6,section,p","block")),avalon.parseDisplay=parseDisplay;var supportDisplay=function(e){return window.getComputedStyle?"table-cell"===window.getComputedStyle(e,null).display:!0}(DOC.createElement("td")),domParser=DOC.createElement("div");domParser.setAttribute("className","t");var fuckIEAttr="t"===domParser.className,propMap={"class":"className","for":"htmlFor"},rdash=/\(([^)]*)\)/,styleEl='<style id="avalonStyle">.fixMsIfFlicker{ display: none!important }</style>';if(styleEl=avalon.parseHTML(styleEl).firstChild,head.insertBefore(styleEl,null),DOC.implementation&&DOC.implementation.hasFeature("MutationEvents","2.0")){var ifCallbacks=[];root.addEventListener("DOMNodeInserted",function(e){for(var t,r=ifCallbacks.concat(),n=0;t=r[n++];)t(e)===!1&&avalon.Array.remove(ifCallbacks,t)})}var bindingHandlers=avalon.bindingHandlers={"if":function(e,t,r){function n(e){return(e?e.target==s:root.contains(s))?(clearInterval(c),a(),avalon(s).removeClass("fixMsIfFlicker"),!1):void 0}function a(){o=s.parentNode,updateViewFactory(e.value,t,e,function(e){if(e){if(!root.contains(s))try{o.replaceChild(s,i),delete l.sourceIndex}catch(t){}avalon.nextTick(r)}else root.contains(s)&&(o.replaceChild(i,s),l.sourceIndex=0)
})}r=r||avalon.noop;var o,i=DOC.createComment("@"),s=e.element,l=e.state;if(root.contains(s))a();else if(avalon(s).addClass("fixMsIfFlicker"),ifCallbacks)ifCallbacks.push(n);else var c=setInterval(n,20)},attr:function(e,t){updateViewFactory(e.value,t,e,function(t,r){var n=e.param,a=t===!1||null===t||void 0===t;a&&r.removeAttribute(n),fuckIEAttr&&n in propMap?(n=propMap[n],a?r.removeAttribute(n):r[n]=t):a||r.setAttribute(n,t)})},on:function(e,t){e.type="on";var r,n=e.value,a="$event",o=e.element,i=e.param;if(n.indexOf("(")>0&&n.indexOf(")")>-1){var s=(n.match(rdash)||["",""])[1].trim();(""===s||"$event"===s)&&(a=void 0,n=n.replace(rdash,""))}else a=void 0;var l=parseExpr(n,t,e,a);if(l){var c=l[0],u=l[1];r=a?function(e){return c.apply(this,u.concat(e))}:c.apply(c,u),o.$vmodels||(o.$vmodel=t[0],o.$vmodels=t),i&&"function"==typeof r&&avalon.bind(o,i,r)}},data:function(e,t){updateViewFactory(e.value,t,e,function(t,r){var n="data-"+e.param;t&&"object"==typeof t?r[n]=t:r.setAttribute(n,String(t))})},text:function(e,t){var r=e.node;updateViewFactory(e.value,t,e,function(e,t){2===r.nodeType?"textContent"in t?t.textContent=e:t.innerText=e:r.nodeValue=e})},visible:function(e,t){var r=e.element;if(!supportDisplay&&!root.contains(r))var n=parseDisplay(r.tagName);n=n||avalon(r).css("display"),n="none"===n?parseDisplay(r.tagName):n,updateViewFactory(e.value,t,e,function(e,t){t.style.display=e?n:"none"})},href:function(e,t){var r=e.value.trim(),n=!0,a=e.type;r.indexOf(openTag)>-1&&r.indexOf(closeTag)>2&&(n=!1,rexpr.test(r)&&""===RegExp.rightContext&&""===RegExp.leftContext&&(n=!0,r=RegExp.$1)),updateViewFactory(r,t,e,function(r,n){if("css"===a)avalon(n).css(e.param,r);else if("include"===a&&r)if("src"===e.param){var o=new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP");o.onreadystatechange=function(){if(4===o.readyState){var r=o.status;(r>=200&&300>r||304===r||1223===r)&&(avalon.innerHTML(n,o.responseText),scanNodes(n,t,e.state))}},o.open("GET",r,!0),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.send(null)}else{var i=DOC.getElementById(r);avalon.nextTick(function(){i&&avalon.innerHTML(n,i.innerHTML),scanNodes(n,t,e.state)})}else n[a]=r},n?null:scanExpr(e.value))},disabled:function(e,t){var r=e.type,n="readonly"===r?"readOnly":r;updateViewFactory(e.value,t,e,function(e,t){t[n]=!!e})},bind:function(e,t){var r=e.value.match(/([$\w]+)\s*\:\s*([$\w]+)/);if(delete e.remove,r&&r[1]&&r[2]){for(var n,a=r[2],o=e.element,i=0;n=t[i++];)if(n.hasOwnProperty(a)){a=n[a];break}"function"==typeof a&&(a.call(o),n.$watch(r[1],function(e,t){a.call(o,e,t)}),e.remove=!0)}},html:function(e,t){updateViewFactory(e.value,t,e,function(t,r){if(t=null==t?"":t+"",e.replaceNodes){var n=avalon.parseHTML(t),a=avalon.slice(n.childNodes);r.insertBefore(n,e.replaceNodes[0]||null);for(var o,i=0;o=e.replaceNodes[i++];)r.removeChild(o);e.replaceNodes=a}else avalon.innerHTML(r,t)})},"with":function(e,t){bindingHandlers.each(e,t,!0)},ui:function(e,t,r){var n=e.value.trim(),a=e.element,o=(a.getAttribute("data-id")||"").trim();if(o||(o=n+setTimeout("1"),a.setAttribute("data-id",o)),a[o+"vmodels"]=t,"function"==typeof avalon.ui[n]){var i=e.param;if(i)for(var s,l=0;s=t[l++];)if(s.hasOwnProperty(i)){r=s.$model[i];break}avalon.ui[n](a,o,t,r||{});try{delete a[o+"vmodels"]}catch(c){a[o+"vmodels"]=void 0}}else delete e.remove}};"class,hover,active".replace(rword,function(e){bindingHandlers[e]=function(t,r){var n,a,o=t.param,i=t.element,s=avalon(i);if(!o||isFinite(o)){var l=t.value,c=l.replace(rexprg,function(e){return Math.pow(10,e.length-1)}),u=c.indexOf(":");if(-1===u)var f,p=l;else{p=l.slice(0,u),f=l.slice(u+1);var d=parseExpr(f,r,{});if(!Array.isArray(d))return log("'"+(f||"").trim()+"' 不存在于VM中"),!1;var h=d[0],v=d[1]}var m=rexpr.test(p);if(updateViewFactory("",r,t,function(t){n=h?!!h.apply(i,v):!0,p=m?t:p,"class"===e&&(n&&a&&s.removeClass(a),s.toggleClass(p,n),a=p)},m?scanExpr(p):null),"hover"===e||"active"===e){if("hover"===e)var g="mouseenter",y="mouseleave";else i.tabIndex=i.tabIndex||-1,g="mousedown",y="mouseup";s.bind(g,function(){n&&s.addClass(p)}),s.bind(y,function(){n&&s.removeClass(p)})}}else"class"===e&&updateViewFactory(t.value,r,t,function(e){s.toggleClass(o,!!e)})}}),"checked,readonly,selected".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.disabled}),bindingHandlers.enabled=function(e,t){updateViewFactory(e.value,t,e,function(e,t){t.disabled=!e})},"title,alt,src,value,css,include".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.href});var modelBinding=bindingHandlers.duplex=bindingHandlers.model=function(e,t){var r=e.element,n=r.tagName;if("model"===e.type&&log("ms-model已经被废弃，请使用ms-duplex"),"function"==typeof modelBinding[n]){var a=parseExpr(e.value,t,e,"setget");if(a){for(var o,i=e.value.split("."),s=i[0],l=i[1],c=t.length-1;o=t[c--];)if(o.hasOwnProperty(s)){if(!l||!o[s])break;if(o[s].hasOwnProperty(l))break}r.name||(r.name=generateID());var u=modelBinding[n](e,a[0],o);u&&registerSubscriber(u,e)}}};modelBinding.INPUT=function(e,t,r){function n(){a.beforeChecked=a.checked}var a=e.element,o=e.param,i=a.type,s=avalon(a);"checkbox"===i&&"radio"===o&&(i="radio");var l=function(){s.data("observe")!==!1&&t(r,a.value)},c=function(){var e=t(r);e!==a.value&&(a.value=e)};if(/^(password|textarea|text|url|email|date|month|time|week|number)$/.test(i)){var u=a.attributes["data-event"]||{};if(u=u.value,"change"===u)avalon.bind(a,u,l);else if(window.addEventListener?a.addEventListener("input",l):a.attachEvent("onpropertychange",function(e){"value"===e.propertyName&&l()}),9===DOC.documentMode){var f=function(e){"focus"===e.type?document.addEventListener("selectionchange",l):document.removeEventListener("selectionchange",l)};a.addEventListener("focus",f),a.addEventListener("blur",f)}}else"radio"===i?(c=function(){a.checked="text"===o?t(r)===a.value:!!t(r)},l=function(){if(s.data("observe")!==!1)if("text"===o)a.checked&&t(r,a.value);else{var e=!a.beforeChecked;t(r,e),a.beforeChecked=a.checked=e}},null===a.onbeforeactivate?s.bind("beforeactivate",n):s.bind("mouseover",n),s.bind("click",l)):"checkbox"===i&&(l=function(){if(s.data("observe")!==!1){var e=a.checked?"ensure":"remove";avalon.Array[e](t(r),a.value)}},c=function(){var e=[].concat(t(r));try{a.checked=e.indexOf(a.value)>=0}catch(n){log("<input type='checkbox' ms-duplex='prop' /> 中prop应为一个数组")}},s.bind("click",l));return c},modelBinding.SELECT=function(e,t,r,n){function a(){if(i.data("observe")!==!1){var e=i.val();e+""!==n&&(t(r,e),n=e+"")}}function o(){var e=t(r);e=Array.isArray(e)?e.map(String):e+"",e+""!==n&&(i.val(e),n=e+"")}var i=avalon(e.element);i.bind("change",a),setTimeout(function(){registerSubscriber(o,e)})},modelBinding.TEXTAREA=modelBinding.INPUT;var eventName={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};for(var name in eventName)if(/object|function/.test(typeof window[name])){eventMap.animationend=eventName[name];break}if("dblclick,mouseout,click,mouseover,mouseenter,mouseleave,mousemove,mousedown,mouseup,keypress,keydown,keyup,blur,focus,change,animationend".replace(rword,function(e){bindingHandlers[e]=function(t){t.param=e,bindingHandlers.on.apply(0,arguments)}}),!("onmouseenter"in root)){var oldBind=avalon.bind,events={mouseenter:"mouseover",mouseleave:"mouseout"};avalon.bind=function(e,t,r){return events[t]?oldBind(e,events[t],function(n){var a=n.relatedTarget;return a&&(a===e||16&e.compareDocumentPosition(a))?void 0:(delete n.type,n.type=t,r.call(e,n))}):oldBind(e,t,r)}}var _splice=[].splice,CollectionPrototype={_splice:_splice,_add:function(e,t){var r=this.length;t="number"==typeof t?t:r;for(var n=[],a=0,o=e.length;o>a;a++)n[a]=convert(e[a]);return _splice.apply(this,[t,0].concat(n)),notifySubscribers(this,"add",n,t),this._stopFireLength?void 0:this._.length=this.length},_del:function(e,t){var r=this._splice(e,t);return r.length&&(notifySubscribers(this,"del",e,t),this._stopFireLength||(this._.length=this.length)),r},push:function(){return[].push.apply(this.$model,arguments),this._add(arguments)},unshift:function(){[].unshift.apply(this.$model,arguments);var e=this._add(arguments,0);return notifySubscribers(this,"index",arguments.length),e},shift:function(){var e=this.$model.shift();return this._del(0,1),notifySubscribers(this,"index",0),e},pop:function(){var e=this.$model.pop();return this._del(this.length-1,1),e},splice:function(e){e=resetNumber(e,this.length);var t=_splice.apply(this.$model,arguments),r=[];return this._stopFireLength=!0,t.length&&(r=this._del(e,t.length),arguments.length<=2&&notifySubscribers(this,"index",0)),arguments.length>2&&this._add(aslice.call(arguments,2),e),this._stopFireLength=!1,this._.length=this.length,r},contains:function(e){return-1!==this.indexOf(e)},size:function(){return this._.length},remove:function(e){var t=this.indexOf(e);return t>=0?this.removeAt(t):void 0},removeAt:function(e){this.splice(e,1)},clear:function(){return this.$model.length=this.length=this._.length=0,notifySubscribers(this,"clear"),this},removeAll:function(e){if(Array.isArray(e))e.forEach(function(e){this.remove(e)},this);else if("function"==typeof e)for(var t=this.length-1;t>=0;t--){var r=this[t];e(r,t)&&this.splice(t,1)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e>=0&&e<this.length){var r=getType(t);rchecktype.test(r)?(t.$model&&(t=t.$model),updateViewModel(this[e],t,r)):this[e]!==t&&(this[e]=t,notifySubscribers(this,"set",e,t))}return this}};"sort,reverse".replace(rword,function(e){CollectionPrototype[e]=function(){[][e].apply(this.$model,arguments);for(var t=!1,r=0,n=this.length;n>r;r++){var a=this.$model[r],o=this[r];if(o=o&&o.$model?o.$model:o,!isEqual(a,o)){t=!0;var i=getVMIndex(a,this,r),s=this._splice(i,1)[0];this._splice(r,0,s),notifySubscribers(this,"move",i,r)}}return t&&notifySubscribers(this,"index",0),this}});var withMapper={};bindingHandlers.each=function(e,t){var r,n,a=e.element,o=parseExpr(e.value,t,e);"object"==typeof o&&(r=o[0].apply(o[0],o[1]));for(var i=documentFragment.cloneNode(!1);a.firstChild;)i.appendChild(a.firstChild);return e.template=i,e.vmodels=t,"object"!=typeof r?r:(Array.isArray(r)?(e.mapper=[],n=function(t,r,a){eachIterator(t,r,a,e,n.host)}):(e.markstone={},n=function(t,r,a){withIterator(t,r,a,e,n.host)}),n.element=a,n.state=e.state,n.host=r,r[subscribers]&&r[subscribers].push(n),n("add",r,0),void 0)};var watchEachOne=oneObject("$index,$remove,$first,$last"),filters=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?e.slice(0,t-r.length)+r:String(e)},camelize:camelize,escape:function(e){return String(e).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},currency:function(e,t){return t=t||"￥",t+avalon.filters.number(e)},number:function(e,t,r,n){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var a=isFinite(+e)?+e:0,o=isFinite(+t)?Math.abs(t):0,i=n||",",s=r||".",l="",c=function(e,t){var r=Math.pow(10,t);return""+Math.round(e*r)/r};return l=(o?c(a,o):""+Math.round(a)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<o&&(l[1]=l[1]||"",l[1]+=new Array(o-l[1].length+1).join("0")),l.join(s)}};new function(){function e(e){return parseInt(e,10)}function t(e,t,r){var n="";for(0>e&&(n="-",e=-e),e=""+e;e.length<t;)e="0"+e;return r&&(e=e.substr(e.length-t)),n+e}function r(e,r,n,a){return function(o){var i=o["get"+e]();return(n>0||i>-n)&&(i+=n),0===i&&-12===n&&(i=12),t(i,r,a)}}function n(e,t){return function(r,n){var a=r["get"+e](),o=(t?"SHORT"+e:e).toUpperCase();return n[o][a]}}function a(e){var r=-1*e.getTimezoneOffset(),n=r>=0?"+":"";return n+=t(Math[r>0?"floor":"ceil"](r/60),2)+t(Math.abs(r%60),2)}function o(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function i(t){var r;if(r=t.match(u)){var n=new Date(0),a=0,o=0,i=r[8]?n.setUTCFullYear:n.setFullYear,s=r[8]?n.setUTCHours:n.setHours;r[9]&&(a=e(r[9]+r[10]),o=e(r[9]+r[11])),i.call(n,e(r[1]),e(r[2])-1,e(r[3]));var l=e(r[4]||0)-a,c=e(r[5]||0)-o,f=e(r[6]||0),p=Math.round(1e3*parseFloat("0."+(r[7]||0)));return s.call(n,l,c,f,p),n}return t}var s={yyyy:r("FullYear",4),yy:r("FullYear",2,0,!0),y:r("FullYear",1),MMMM:n("Month"),MMM:n("Month",!0),MM:r("Month",2,1),M:r("Month",1,1),dd:r("Date",2),d:r("Date",1),HH:r("Hours",2),H:r("Hours",1),hh:r("Hours",2,-12),h:r("Hours",1,-12),mm:r("Minutes",2),m:r("Minutes",1),ss:r("Seconds",2),s:r("Seconds",1),sss:r("Milliseconds",3),EEEE:n("Day"),EEE:n("Day",!0),a:o,Z:a},l=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,c=/^\d+$/,u=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;filters.date=function(t,r){var n,a,o=filters.date.locate,u="",f=[];if(r=r||"mediumDate",r=o[r]||r,"string"==typeof t&&(t=c.test(t)?e(t):i(t),t=new Date(t)),"number"==typeof t&&(t=new Date(t)),"date"===getType(t)){for(;r;)a=l.exec(r),a?(f=f.concat(a.slice(1)),r=f.pop()):(f.push(r),r=null);return f.forEach(function(e){n=s[e],u+=n?n(t,o):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),u}};var f={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d ah:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"ah:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};f.SHORTMONTH=f.MONTH,filters.date.locate=f};var innerRequire,modules=avalon.modules={"ready!":{exports:avalon},avalon:{exports:avalon,state:2}};new function(){function e(e){return(e||"").replace(/[?#].*/,"")}function t(e){var t;try{a.b.c()}catch(r){t=r.stack,!t&&window.opera&&(t=(String(r).match(/of linked script \S+/g)||[]).join(" "))}if(t)return t=t.split(/[@ ]/g).pop(),t="("===t[0]?t.slice(1,-1):t.replace(/\s/,""),t.replace(/(:\d+)?:\d+$/i,"");for(var n,o=(e?DOC:head).getElementsByTagName("script"),i=o.length;n=o[--i];)if((e||n.className===subscribers)&&"interactive"===n.readyState)return n.className=n.src}function r(e,t){for(var n in e)if("司徒正美"===e[n]&&2!==modules[n].state&&(n===t||r(modules[n].deps,t)))return!0}function n(){e:for(var e,t=u.length;e=u[--t];){var r=modules[e],a=r.deps;for(var o in a)if(ohasOwn.call(a,o)&&2!==modules[o].state)continue e;2!==r.state&&(u.splice(t,1),l(r.id,r.args,r.factory),n())}}function o(t,r,n){var a=e(t.src);return t.onload=t.onreadystatechange=t.onerror=null,r||n&&!modules[a].state?(setTimeout(function(){head.removeChild(t),t=null}),log("加载 "+a+" 失败"+r+" "+!modules[a].state),void 0):!0}function i(t,r,n,a){if("ready!"===t||modules[t]&&2===modules[t].state)return t;kernel.alias[t]&&(t=kernel.alias[t],"object"==typeof t&&(a=t,t=t.src));var o;if(t=t.replace(/^\w+!/,function(e){return o=e.slice(0,-1),""}),o=o||"js",o=plugins[o]||noop,/^(\w+)(\d)?:.*/.test(t))n=t;else{r=r.substr(0,r.lastIndexOf("/"));var i=t.charAt(0);if("."!==i&&"/"!==i)n=c+t;else if("./"===t.slice(0,2))n=r+t.slice(1);else if(".."===t.slice(0,2)){var s=r.replace(/\/$/,"").split("/");i=t.replace(/\.\.\//g,function(){return s.pop(),""}),n=s.join("/")+"/"+i}else"/"===i?n=r+t:avalon.error("不符合模块标识规则: "+t)}t=e(n);var l=o.ext;return l&&t.slice(0-l.length)!==l&&(n+=l),kernel.nocache&&(n+=(-1===n.indexOf("?")?"?":"&")+(new Date-0)),o(n,a)}function s(e,t,r){var n=DOC.createElement("script");n.className=subscribers,n[W3C?"onload":"onreadystatechange"]=function(){if(W3C||/loaded|complete/i.test(n.readyState)){var a=f.pop();a&&a.delay(t),r&&r(),o(n,!1,!W3C)&&log("已成功加载 "+e)}},n.onerror=function(){o(n,!0)},n.src=e,head.insertBefore(n,head.firstChild),log("正准备加载 "+e)}function l(e,t,r){for(var n,a=0,o=[];n=t[a++];)o.push(modules[n].exports);var i=Object(modules[e]),s=r.apply(window,o);return i.state=2,void 0!==s&&(modules[e].exports=s),s}var c,u=[],f=[];plugins.js=function(t,r){var n=e(t);return modules[n]||(modules[n]={id:n,parent:parent,exports:{}},r?innerRequire(r.deps||"",function(){s(t,n,function(){modules[n].state=2,r.exports&&(modules[n].exports="function"==typeof r.exports?r.exports():window[r.exports]),innerRequire.checkDeps()})}):s(t,n)),n},plugins.css=function(e){var t=e.replace(/(#.+|\W)/g,"");if(!DOC.getElementById(t)){var r=DOC.createElement("link");r.rel="stylesheet",r.href=e,r.id=t,head.insertBefore(r,head.firstChild)}},plugins.css.ext=".css",plugins.js.ext=".js";var p=t(!0);p||(p=avalon.slice(document.scripts).pop().src);var d=e(p);c=kernel.base=d.slice(0,d.lastIndexOf("/")+1),innerRequire=avalon.require=function(e,t,r){var a={},o=[],s=0,f=0,p=r||"callback"+setTimeout("1");r=r||c,String(e).replace(rword,function(e){var t=i(e,r);t&&(s++,modules[t]&&2===modules[t].state&&f++,a[t]||(o.push(t),a[t]="司徒正美"))}),modules[p]={id:p,factory:t,deps:a,args:o,state:1},s===f?l(p,o,t):u.unshift(p),n()},innerRequire.define=function(n,a,o){var i=aslice.call(arguments);if("string"==typeof n)var s=i.shift();if("boolean"==typeof i[0]){if(i[0])return;i.shift()}"function"==typeof i[0]&&i.unshift([]);var l=modules[s]&&modules[s].state>=1?s:e(t());!modules[l]&&s&&(modules[l]={id:l,factory:o,state:1}),o=i[1],o.id=s,o.delay=function(e){i.push(e);var t=!0;try{t=r(modules[e].deps,e)}catch(n){}t&&avalon.error(e+"模块与之前的某些模块存在循环依赖"),delete o.delay,innerRequire.apply(null,i)},l?o.delay(l,i):f.push(o)},innerRequire.define.amd=modules,innerRequire.config=kernel,innerRequire.checkDeps=n};var ready=W3C?"DOMContentLoaded":"readystatechange";"complete"===DOC.readyState?fireReady():W3C?DOC.addEventListener(ready,function(){fireReady()}):(DOC.attachEvent("onreadystatechange",function(){"complete"===DOC.readyState&&fireReady()}),root.doScroll&&doScrollCheck()),avalon.ready=function(e){innerRequire("ready!",e)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan(document.body)})}(document),avalon.config({loader:!1}),avalon.filters.richText=function(e){return e.replace(/\r?\n/gi,"<br/>").replace(/ |  /gi,"&nbsp;")};var titlRegForAvalonFilter=/#+.+\n+/;avalon.filters.removeSummeryTitle=function(e){return e.replace(titlRegForAvalonFilter,"")},avalon.filters.md2html=function(e){return Converter.makeHtml(e)},avalon.filters.md2head=function(e){return e.replace(/^#+/,"")},avalon.filters.addSyntexType=function(e){var t=e.split("<pre><code>$"),r=t.length;if(r>1)for(var n=0;r>n+1;n++){var a=t[n+1].indexOf("$"),o=t[n+1].substr(0,a);t[n]+='<pre><code class="language-'+o+'">',t[n+1]=t[n+1].substr(a+1,t[n+1].length),t[n+1]=t[n+1].replace(/\n/,"")}return t.join("")},function(){function e(e){for(var t=[""],r=0;r<e.length;r++){var n=e.charAt(r);"/"!==n?"("===n?(t.push("("),t.push("")):")"===n?(t.push(")"),t.push("")):t[t.length-1]+=n:t.push("")}return t.filter(function(e){return 0!==e.length})}function t(e){for(var r,n=[];void 0!==(r=e.shift());)if(!(r.length<=0))switch(r){case"(":n.push(t(e));break;case")":return n;default:n.push(r)}return n}function r(r){var n=e(r),a=t(n);return a}function n(){this.routingTable={}}function a(e){var t=e.split("#"),r={},n=t[1];if(n){var a=n.indexOf("?");if(a>0)for(var o,i=n.slice(a+1).split("&"),s=i.length,l=0;s>l;l++)i[l]&&(o=i[l].split("="),r[decodeURIComponent(o[0])]=decodeURIComponent(o[1]))}return{pathname:t[0],query:r}}[].reduce||(Array.prototype.reduce=function(e,t,r){if(0==this.length)return t;for(var n=void 0!==t?0:1,a=void 0!==t?t:this[0],o=this.length;o>n;n++)a=e.call(r,a,this[n],n,this);return a});var o=function(e,t){var r=e.shift(),n=e.shift();if(void 0===n)return r;var a=r.map(function(e){return n.map(function(r){return t(e,r)})}).reduce(function(e,t){return e.concat(t)});return 0===e.length?a:o([a].concat(e),t)};return n.prototype={_set:function(e,t,r){var n=t.shift();if(n.length<=0&&avalon.error("构建失败"),n.charAt&&":"===n.charAt(0)){var a=n.substring(1);if(e.hasOwnProperty("^n")&&e["^n"]!==a)return!1;e["^n"]=a,n="^v"}if(0===t.length)return e[n]=r,!0;var o=e.hasOwnProperty(n)?e[n]:e[n]={};return this._set(o,t,r)},error:function(e){this.errorback=e},add:function(e,t,n){var a=r(t),o=this._expandRules(a);if(0===o.length){var i=[e,0];this._set(this.routingTable,i,n)}else{var s=this;o.every(function(t){var r=t.length,a=[e,r].concat(t);return s._set(s.routingTable,a,n)})}return n},routeWithQuery:function(e,t){var r=a(t),n=this.route(e,r.pathname);return n?(n.query=r.query,n):void 0},route:function(e,t){t=t.trim();for(var r,n,a,o=t.split("/"),i=Array(o.length),s=0,l={},c=[],u=[],f=0;f<o.length;++f)r=o[f],0!==r.length&&(i[s]=r,s++);if(i.length=s,c=this.routingTable[e],void 0!==c&&(c=c[i.length],void 0!==c)){for(a=0;a<i.length;++a)if(n=i[a],c.hasOwnProperty(n))c=c[n];else{if(!c.hasOwnProperty("^v"))return;l[c["^n"]]=n,u.push(n),c=c["^v"]}return{query:{},path:t,args:u,params:l,value:c}}},_expandRules:function(e){if(Array.isArray(e)&&0===e.length)return[];var t=this,r=o(e.map(function(e){if("string"==typeof e)return[[e]];if(Array.isArray(e))return t._expandRules(e).concat([[]]);throw new Error("这里的值只能是字符串或数组 {{"+e+"}}")}),function(e,t){return e.concat(t)});return r},navigate:function(e){var t=this.routeWithQuery("GET",e);if(t){var r=t.value;if("function"==typeof r)return r.apply(t,t.args)}else"function"==typeof this.errorback&&this.errorback(e)}},"get,put,delete,post".replace(avalon.rword,function(e){return n.prototype[e]=function(t,r){return this.add(e.toUpperCase(),t,r)}}),avalon.router=new n,avalon}(),function(){function e(e){for(var t,r=0;t=e[r++];)if("A"===t.nodeName)return t}function t(t,r){t=t.replace(i,"").replace(/#.*/,""),t=decodeURIComponent(t),(r=document.getElementById(t))?r.scrollIntoView():(r=e(document.getElementsByName(t)))?r.scrollIntoView():window.scrollTo(0,0)}var r,n=avalon.History=function(){this.location2hash={}},a={basepath:"/",html5Mode:!1,hashPrefix:"!",interval:50,fireAnchor:!0},o=/^\/+|\/+$/g,i=/^\//,s=/^#(!)?\//,l=/^[^#]*(#.+)$/,c=document.createElement("a");n.started=!1,n.IEVersion=function(){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}();var u="",f="",p=!1;n.prototype={constructor:n,start:function(e){function l(){var e=location.href;if(r&&w!==e){w=e;var t=r.location2hash[w]||"";d(t)}}function d(e){var n=avalon.router;e=e.replace(s,"/"),n&&n.navigate&&n.navigate(e),r.options.fireAnchor&&t(e)}function h(){if(p||!r.iframe)return!1;p=!0;var e=r.iframe.document,t=r.location2hash[document.URL]||"",n=r.location2hash[e.URL]||"";t!==f?(f=t,n!==t&&(u=n=t,e.open(),e.write(y),e.close(),e.location.hash=t),d(t)):n!==u&&(u=n,b&&""===n?history.go(-1):location.hash=n),p=!1}if(n.started)throw new Error("avalon.history has already been started");n.started=!0,this.options=avalon.mix({},a,this.options,e);var v=window.VBArray&&n.IEVersion<=7;this.supportPushState=!!window.history.pushState,this.supportHashChange=!(!("onhashchange"in window)||window.VBArray&&v),this.html5Mode=!!this.options.html5Mode,this.supportPushState||(avalon.log("如果浏览器不支持HTML5 pushState，强制使用hash hack!"),this.html5Mode=!1),c.href=("/"+this.options.basepath+"/").replace(o,"/");var m=n.getAbsolutePath(c);c.href="/";var g=n.getAbsolutePath(c);this.basepath=m.replace(/\/$/,""),this.rootpath=g.replace(/\/$/,""),this.rbasepath=new RegExp("^"+this.basepath,"i"),this.rrootpath=new RegExp("^"+this.rootpath,"i"),this.location2hash[this.basepath]="",this.location2hash[m]="";var y="<!doctype html><html><body>@</body></html>";if(this.options.domain&&(y=y.replace("<body>","<script>document.domain ="+this.options.domain+"</script><body>")),v&&!this.html5Mode){avalon.ready(function(){var e=avalon.parseHTML('<iframe src="javascript:0"  tabindex="-1" style="display:none" />').firstChild;document.body.appendChild(e),r.iframe=e.contentWindow;var t=r.iframe.document;t.open(),t.write(y),t.close()});var b=!!n.getHash(location.href)}var w=location.href;if(this.html5Mode?(this.checkUrl=avalon.bind(window,"popstate",l),this._fireLocationChange=l):this.checkUrl=this.supportHashChange?avalon.bind(window,"hashchange",l):setInterval(h,this.options.interval),this.html5Mode===!1){if(this.basepath===location.href.replace(/\/$/,""))d("/");else if(-1!==location.href.indexOf("#!")){var x=location.href.split("#!")[1];this.location2hash[location.href]="#"+this.options.hashPrefix+"/"+x.replace(i,""),d(x)}}else this.html5Mode===!0&&this.rbasepath.test(location.href)&&d(RegExp.rightContext)},stop:function(){avalon.unbind(window,"popstate",this.checkUrl),avalon.unbind(window,"hashchange",this.checkUrl),clearInterval(this.checkUrl),n.started=!1},getLocation:function(){return n.getfullPath(window.location)},setLocation:function(e,t){var n="#"+this.options.hashPrefix+"/";if(!this.html5Mode)var a=n+t.replace(i,"");e!==this.getLocation()&&(this.html5Mode&&i.test(e)?(history.pushState({path:e},window.title,e),this.location2hash[location.href]=t,avalon.nextTick(r._fireLocationChange)):(window.location.hash=a,this.location2hash[location.href]=a))}},n.targetIsThisWindow=function(e){return!e||e===window.name||"_self"===e||"top"===e&&window==window.top?!0:!1},n.getHash=function(e){var t=e.toString().match(l);return t?t[1]:""},n.getfullPath=function(e){return[e.pathname,e.search,n.getHash(e)].join("")},n.getAbsolutePath=function(e){return e.hasAttribute?e.href:e.getAttribute("href",4)},r=avalon.history=new n;var d=/^([\w\d]+):\/\/([\w\d\-_]+(?:\.[\w\d\-_]+)*)/;return avalon.bind(document,"click",function(e){var t="defaultPrevented"in e?e.defaultPrevented:e.returnValue===!1;if(!(t||e.ctrlKey||e.metaKey||2===e.which)){for(var a=e.target;"A"!==a.nodeName;)if(a=a.parentNode,!a||"Body"===a.nodeName)return;var i=a.hostname;if(!i){var s=document.querySelector?a+"":a.getAttribute("href",4);i=(s.match(d)||["","",""])[2]}if(i===window.location.hostname&&n.targetIsThisWindow(a.target)){var l=a.getAttribute("href",2);if(0===l.indexOf("#/")){c.href=("/"+r.options.basepath+"/").replace(o,"/")+l.slice(2);var u=n.getAbsolutePath(c);return e.preventDefault(),r.setLocation(u.replace(r.rrootpath,""),u.replace(r.rbasepath,"")),!1}}}}),avalon}();